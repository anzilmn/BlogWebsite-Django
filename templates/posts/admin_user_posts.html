{% load static %}
{% load paginator_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/icons/blog-logo.svg' %}" />
    <title>{{ user.username }}'s Posts | Blog Post</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}" type="text/css" />
    <script src="{% static 'js/jquery-3.6.0.min.js' %}"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    

     <style>

        header h1 a img {
            transition: transform 0.3s ease-in-out;
        }
        
        header h1 a:hover img {
            transform: scale(1.1) rotate(-2deg);
        }
        
        
        
        /* General Button Styling */
button, 
a.login, 
a.view, 
a.danger {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 10px 16px;
    font-size: 16px;
    font-weight: bold;
    text-decoration: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
}

/* Default Button Styles */
.view {
   
    color: white;
    border: none;
}

.view:hover {
     
    transform: scale(1.05);
}

/* Danger Button (Delete) */
.danger {
    background: transparent;
    padding: 6px;
    border-radius: 50%;
    transition: all 0.3s ease-in-out;
}

.danger:hover {
    transform: scale(1.1);
    
}

/* Delete Icon Color Change */
.danger img {
    transition: filter 0.3s ease-in-out;
}

.danger:hover img {
    filter: invert(25%) sepia(100%) saturate(300%) hue-rotate(350deg);
}

/* Login & Create Post Button */
.login {
     
    color: white;
    padding: 10px 18px;
    border: none;
    font-weight: bold;
}

.login:hover {
  
    transform: translateY(-2px);
}

/* Pagination Buttons */
.pagination a, 
.pagination .prev, 
.pagination .next {
    padding: 8px 12px;
    border-radius: 6px;
   
    transition: all 0.3s ease-in-out;
}

.pagination a:hover {
  
    transform: scale(1.05);
}

/* Add Floating Effect on Hover for Posts */
.post {
    background: #f3f4f6;
    transition: all 0.3s ease-in-out;
}

.post:hover {
    transform: translateY(-5px);
    box-shadow: 0px 10px 20px rgba(0, 0, 0, 0.15);
}

      
/* Pagination Transition Styling */
.pages a, .pages span.active {
    transition: all 0.3s ease-in-out;
    padding: 5px 10px;
    border-radius: 5px;
    text-decoration: none;
    font-weight: bold;
}

.pages a:hover {
    background-color: #3085d6;
    color: white;
    transform: scale(1.1);
}

.pages span.active {
    background-color: #d33;
    color: white;
    transform: scale(1.1);
}


       

        
    </style>


</head>
<body>
    <section id="my-posts-home">
        <section class="wrapper">
            <header>
                <h1>
                    <a href="{% url 'users:users_list' %}">
                        <img src="{% static 'images/icons/blog-logo.svg' %}" alt="Logo" />
                    </a>
                </h1>
                <div>
                    {% if request.user.is_authenticated %}
                        {% if request.user.is_superuser %}
                            <span style="color: black; font-weight: bold; margin-right: 10px;">
                                Welcome, {{ request.user.username }} ({{ request.user.email }}) üëë
                            </span>
                            <a href="{% url 'users:logout' %}" class="login" style="background-color: red; color: white">Logout</a>
                        {% else %}
                            <span style="color: black; font-weight: bold; margin-right: 10px;">
                                Welcome, {{ request.user.username }}‚ù§Ô∏è
                            </span>
                            <a href="{% url 'posts:create_post' %}" class="login my-posts">Create</a>
                            <a href="{% url 'posts:my_posts' %}" class="login my-posts">My Posts</a>
                            <a href="{% url 'users:logout' %}" class="login">Logout</a>
                        {% endif %}
                    {% else %}
                        <a href="{% url 'users:sign_log' %}" class="login">Login</a>
                    {% endif %}
                </div>
            </header>
            <section class="spotlight">
                <h3>{{ title }}</h3>
                <ul class="posts">
                    {% for instance in instances %}
                    <li class="post">
                        <div class="top">
                            <h5 class="title">{{ instance.title }}</h5>
                            <div class="buttons">


                                <a 
                                href="{% url 'posts:delete_post' id=instance.id %}" 
                                id="delete_postt"
                                class="danger"
                                data-text="Are you sure you want to remove this post? You can't undo this action." 
                                data-title="Confirm Delete!"
                                title="Delete!"
                            >
                                <img src="{% static 'images/icons/delete.svg' %}" alt="Delete" />
                            </a>


                            </div>
                        </div>
                        <p class="description">{{ instance.short_description }}</p>
                        <div class="bottom">
                            <a href="{% url 'web:post' id=instance.id %}" class="view">
                                View
                                <span>
                                    <img src="{% static 'images/icons/up-arrow.svg' %}" alt="Arrow">
                                </span>
                            </a>
                            <p class="date">{{ instance.published_date }}</p>
                        </div>
                    </li>
                    {% empty %}
                    <li>No posts found. <a href="{% url 'posts:create_post' %}">Create a post</a></li>
                    {% endfor %}
                </ul>

                {% if instances.has_other_pages %}
                <div class="pagination">
                    {% if instances.has_previous %}
                    {% change_params instances.previous_page_number as prev_url %}
                    <a href="{{ prev_url }}" class="prev">
                        <span class="arrow">
                            <img src="{% static 'images/icons/arrow.svg' %}" alt="Arrow" />
                        </span>
                        Previous
                    </a>
                    {% else %}
                    <div class="prev disabled">
                        <span class="arrow">
                            <img src="{% static 'images/icons/arrow.svg' %}" alt="Arrow" />
                        </span>
                        Previous
                    </div>
                    {% endif %}

                    <div class="pages">
                        {% get_elided_page_range instances.paginator instances.number as page_range %}
                        {% for i in page_range %}
                            {% if instances.number == i %}
                                <span class="active">{{ i }}</span>
                            {% else %}
                                {% change_params i as current_url %}
                                <a href="{{ current_url }}">{{ i }}</a>
                            {% endif %}
                        {% endfor %}
                    </div>

                    {% if instances.has_next %}
                    {% change_params instances.next_page_number as next_url %}
                    <a href="{{ next_url }}" class="next">
                        Next
                        <span class="arrow">
                            <img src="{% static 'images/icons/arrow.svg' %}" alt="Arrow" />
                        </span>
                    </a>
                    {% else %}
                    <div class="next disabled">
                        Next
                        <span class="arrow">
                            <img src="{% static 'images/icons/arrow.svg' %}" alt="Arrow" />
                        </span>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </section>
        </section>
    </section>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll("#delete_postt").forEach(button => {
                button.addEventListener("click", function (event) {
                    event.preventDefault(); // Prevent default link behavior
                    this.focus(); // Ensure the button is focused
        
                    let deleteUrl = this.getAttribute("href"); // Get the delete URL
                    let title = this.getAttribute("data-title") || "Confirm Delete!";
                    let text = this.getAttribute("data-text") || "Are you sure you want to remove this post?";
    
                    setTimeout(() => {
                        if (document.activeElement === this) { // Ensure button is still focused
                            Swal.fire({
                                title: title,
                                text: text,
                                icon: "warning",
                                showCancelButton: true,
                                confirmButtonColor: "#d33", // Red for delete
                                cancelButtonColor: "#3085d6",
                                confirmButtonText: "Yes, delete it!" // ‚úÖ Corrected button text
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    fetch(deleteUrl, {
                                        method: "GET",
                                        headers: { 
                                            "X-Requested-With": "XMLHttpRequest" // Ensure Django detects AJAX
                                        }
                                    })
                                    .then(response => {
                                        if (!response.ok) {
                                            throw new Error("Network response was not ok.");
                                        }
                                        return response.json();
                                    })
                                    .then(data => {
                                        if (data.status === "success") {
                                            Swal.fire({
                                                title: "Deleted!",
                                                text: data.message,
                                                icon: "success",
                                                confirmButtonText: "OK"
                                            }).then(() => {
                                                location.reload(); // Reload the same page
                                            });
                                        } else {
                                            throw new Error(data.message || "An error occurred.");
                                        }
                                    })
                                    .catch(error => {
                                        Swal.fire("Error!", error.message, "error");
                                    });
                                }
                            });
                        }
                    }, 100);
                });
            });
        });
    </script>
    
    
</body>
</html>
